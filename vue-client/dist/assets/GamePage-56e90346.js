import{f as m,l as re,q as _e,s as ge,u as fe,k as U,x as ke,y as ae,o as n,c as o,a as e,j as v,t as u,F as D,m as G,e as q,h as le,v as ne,z as $,p as oe}from"./index-02cc848c.js";import{u as Q}from"./useApi-0fdb8b38.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-78d57de0.js";function Se(){const s=m(null),y=m(!1),_=m(null),{getUserProfile:W}=Q(),Y=()=>{try{const r=localStorage.getItem("user");return r?(s.value=JSON.parse(r),!0):!1}catch(r){return console.error("Failed to parse user from localStorage:",r),!1}},V=async(r=!1)=>{var b,a;if(!r&&Y())return s.value;try{y.value=!0,_.value=null;const c=await W();return c.data?(s.value=c.data,localStorage.setItem("user",JSON.stringify(c.data)),c.data):null}catch(c){return _.value=((a=(b=c.response)==null?void 0:b.data)==null?void 0:a.message)||c.message||"Failed to fetch user",console.error("Failed to get current user:",c),null}finally{y.value=!1}},B=()=>!!localStorage.getItem("token")&&!!localStorage.getItem("user"),j=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),s.value=null},g=()=>localStorage.getItem("token");return re(()=>{Y()}),{user:s,loading:y,error:_,getCurrentUser:V,isAuthenticated:B,clearAuth:j,getToken:g,loadUserFromStorage:Y}}const Ie=_e("game",{state:()=>({currentUser:null,currentRoom:null,gameState:"LOBBY",players:[],communityCards:[],playerCards:[],currentTurn:0,pot:0,smallBlind:0,bigBlind:0,minBuyIn:0,maxBuyIn:0}),actions:{setUser(s){this.currentUser=s},clearUser(){this.currentUser=null},setRoom(s){this.currentRoom=s,this.smallBlind=s.sbet||0,this.bigBlind=s.bbet||0,this.minBuyIn=s.minbuy||0,this.maxBuyIn=s.maxbuy||0},clearRoom(){this.currentRoom=null,this.players=[],this.communityCards=[],this.playerCards=[],this.currentTurn=0,this.pot=0},setGameState(s){this.gameState=s},updatePlayer(s){const y=this.players.findIndex(_=>_.uid===s.uid);y>=0?this.players[y]=s:this.players.push(s)},removePlayer(s){this.players=this.players.filter(y=>y.uid!==s)},setCommunityCards(s){this.communityCards=s},addCommunityCard(s){this.communityCards.push(s)},setPlayerCards(s){this.playerCards=s},setTurn(s){this.currentTurn=s},setPot(s){this.pot=s},resetGame(){this.gameState="LOBBY",this.communityCards=[],this.playerCards=[],this.currentTurn=0,this.pot=0}},getters:{isPlayerTurn:s=>{var y;return s.currentTurn===((y=s.currentUser)==null?void 0:y.uid)},currentPlayer:s=>s.players.find(y=>{var _;return y.uid===((_=s.currentUser)==null?void 0:_.uid)}),isInRoom:s=>s.currentRoom!==null,isGameInProgress:s=>s.gameState==="PLAYING"}});const xe={class:"game-page container mt-4"},Be={key:0,class:"text-center my-5"},Pe={key:1,class:"alert alert-danger"},Te={key:2,class:"game-container"},Le={class:"game-header card mb-4"},we={class:"card-body"},Re={class:"d-flex justify-content-between align-items-center"},Ae={class:"mb-0"},Ne={class:"text-muted mb-0"},Oe=["disabled"],Ue={class:"game-status card mb-4"},$e={class:"card-body"},Fe={class:"d-flex justify-content-between align-items-center mb-3"},De={class:"mb-0"},Ge={class:"mb-0"},Ye={class:"mb-0"},Ee={class:"mb-0"},Me={class:"badge bg-primary me-2"},He={key:0,class:"badge bg-success"},We={key:0,class:"lobby-actions d-flex gap-2"},Ve=["disabled"],je=["disabled"],Ke=["disabled"],Je={class:"player-hand card mb-4"},ze={class:"card-body"},qe={class:"hand-cards d-flex justify-content-center"},Qe={key:0,class:"d-flex gap-3"},Xe={class:"card-body p-2 text-center"},Ze={class:"card-rank"},et={key:1,class:"text-muted"},tt={class:"community-cards card mb-4"},st={class:"card-body"},at={class:"community-cards-container d-flex justify-content-center"},lt={class:"card-body p-2 text-center"},nt={class:"card-rank"},ot={key:0,class:"text-center mt-2"},rt={class:"badge bg-info"},ut={class:"player-actions card mb-4"},it={class:"card-body"},dt={key:0},ct={key:1},vt={key:2,class:"player-info mb-3"},mt={class:"mb-0"},yt={class:"mb-0"},bt={class:"mb-0"},pt={class:"action-buttons d-flex justify-content-center gap-2"},ht=["disabled"],_t=["disabled"],gt=["disabled"],ft=["disabled"],kt=["disabled"],Ct=["disabled"],St={key:3,class:"mt-3"},It={class:"input-group"},xt=["disabled"],Bt=["disabled"],Pt={class:"game-log card"},Tt={class:"card-body"},Lt={key:3,class:"modal fade show",style:{display:"block"},tabindex:"-1"},wt={class:"modal-dialog"},Rt={class:"modal-content"},At={class:"modal-header"},Nt={class:"modal-body"},Ot={class:"seat-grid"},Ut={class:"row"},$t=["onClick","disabled"],Ft={class:"modal-footer"},Dt={key:4,class:"modal fade show",style:{display:"block"},tabindex:"-1"},Gt={class:"modal-dialog"},Yt={class:"modal-content"},Et={class:"modal-header"},Mt={class:"modal-title"},Ht={class:"modal-body"},Wt={class:"mb-3"},Vt={class:"form-label"},jt=["min","max"],Kt={class:"text-muted"},Jt={class:"modal-footer"},zt=["disabled"],qt={key:5,class:"modal-backdrop fade show"},Qt={__name:"GamePage",setup(s){const{getUserProfile:y,gameAction:_,leaveRoom:W,getRoomInfo:Y}=Q(),{getCurrentUser:V}=Se(),B=ge(),j=fe(),g=Ie(),r=m(!1),b=m(""),a=m(null),c=m({}),E=m(!1),F=m(0),P=m([]),I=m(null),x=m(null),f=m("spectator"),M=m(1e3),T=m(!1),L=m(!1),ue=m([1,2,3,4,5,6,7,8]);let K=null;const S=U(()=>a.value&&a.value.currentTurnPlayerId===c.value.uid),w=U(()=>{var i,t;return(t=(i=a.value)==null?void 0:i.players)==null?void 0:t.find(d=>d.id===c.value.uid)}),p=U(()=>a.value&&a.value.gamePhase&&a.value.gamePhase!=="LOBBY"),ie=U(()=>f.value==="spectator"&&!p.value),de=U(()=>f.value==="sitting"&&!p.value),ce=U(()=>f.value==="sitting"&&!p.value);re(async()=>{await J(),K=setInterval(J,5e3)}),ke(()=>{K&&clearInterval(K)});const J=async()=>{var i,t;try{r.value=!0,b.value="";const d=await V();if(d)c.value=d,console.log("Loaded user:",c.value);else{const h=await y();c.value=h.data}const k=await Q().get(`/api/v1/game/${B.params.roomId}/state`);if(k.data&&k.data.success){a.value=k.data.data,g.setRoom({roomid:a.value.room.roomid,name:a.value.room.name,sbet:50,bbet:100,minbuy:500,maxbuy:5e3});const h=a.value.players.find(R=>R.id===c.value.uid);h&&(c.value={...c.value,...h},x.value=h.seatId,f.value=h.seatId>=0?"sitting":"spectator",f.value==="sitting"&&p.value&&(f.value="playing")),X(`Game state updated - ${a.value.gamePhase||"LOBBY"} phase`)}}catch(d){b.value="Failed to load game state: "+(((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.message)||d.message)}finally{r.value=!1}},X=i=>{P.value.push(i),P.value.length>50&&(P.value=P.value.slice(-50)),ae(()=>{I.value&&(I.value.scrollTop=I.value.scrollHeight)})},C=async i=>{var t,d,k;try{if(r.value=!0,b.value="",i==="RAISE"){E.value=!0;return}const R={FOLD:"4",CHECK:"2",CALL:"3",RAISE:"2",ALL_IN:"5",LOOK:"1",SITDOWN:"6",STANDUP:"7",START:"sbot",LEAVE:"8"}[i],A={};i==="SITDOWN"&&(A.sid=x.value,A.cb=M.value);const N=await _(B.params.roomId,R,A);if(N.data&&N.data.success){const H={FOLD:"folded",CHECK:"checked",CALL:`called (${a.value.currentBet} chips)`,ALL_IN:"went all-in",LOOK:"looked at cards",SITDOWN:`sat down at seat ${x.value} with ${M.value} chips`,STANDUP:"stood up from the table",START:"started the game"}[i]||i;X(`You ${H}`),i==="SITDOWN"?(f.value="sitting",T.value=!1):i==="STANDUP"?(f.value="spectator",x.value=null):i==="START"&&(f.value="playing"),await J()}else b.value="Failed to perform action: "+(((t=N.data)==null?void 0:t.message)||"Unknown error")}catch(h){b.value="Failed to perform action: "+(((k=(d=h.response)==null?void 0:d.data)==null?void 0:k.message)||h.message)}finally{r.value=!1}},ve=i=>{x.value=i,L.value=!1,T.value=!0},me=async()=>{await C("START")},ye=async()=>{var i,t;try{r.value=!0,b.value="";const d=await W(B.params.roomId);g.clearRoom(),j.push({name:"rooms"})}catch(d){b.value="Failed to leave room: "+(((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.message)||d.message)}finally{r.value=!1}},be=i=>({PRE_FLOP:"Pre-Flop",FLOP:"Flop",TURN:"Turn",RIVER:"River",SHOWDOWN:"Showdown",LOBBY:"Lobby"})[i]||i,pe=async()=>{var i,t;try{r.value=!0,b.value="";const d=parseInt(F.value);if(isNaN(d)||d<=0){b.value="Please enter a valid raise amount";return}const k=await _(B.params.roomId,"RAISE",{amount:d});P.value.push(`You raised to ${d} chips`),E.value=!1,F.value=0,await ae(),I.value&&(I.value.scrollTop=I.value.scrollHeight)}catch(d){b.value="Failed to raise: "+(((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.message)||d.message)}finally{r.value=!1}},he=()=>{E.value=!1,F.value=0};return(i,t)=>{var d,k,h,R,A,N,z,H,Z,ee,te,se;return n(),o("div",xe,[r.value?(n(),o("div",Be,[...t[15]||(t[15]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-3"},"Loading game...",-1)])])):v("",!0),b.value?(n(),o("div",Pe,u(b.value),1)):v("",!0),!r.value&&a.value?(n(),o("div",Te,[e("div",Le,[e("div",we,[e("div",Re,[e("div",null,[e("h2",Ae,u(a.value.room.name),1),e("p",Ne,u(a.value.room.roomTypeName)+" | Players: "+u(a.value.room.getPlayerCount())+" / "+u(a.value.room.maxPlayers),1)]),e("div",null,[e("button",{onClick:ye,class:"btn btn-danger",disabled:r.value}," Leave Room ",8,Oe)])])])]),e("div",Ue,[e("div",$e,[e("div",Fe,[e("div",null,[e("h5",null,"Current Hand: "+u(((d=a.value)==null?void 0:d.currentHand)||"N/A"),1),e("p",De,"Pot: "+u(((k=a.value)==null?void 0:k.pot)||0)+" chips",1),e("p",Ge,"Game Phase: "+u(((h=a.value)==null?void 0:h.gamePhase)||"LOBBY"),1)]),e("div",null,[e("h5",null,"Current Bet: "+u(((R=a.value)==null?void 0:R.currentBet)||0)+" chips",1),e("p",Ye,"Your Chips: "+u(((A=w.value)==null?void 0:A.chips)||c.value.allMoney||0),1),e("p",Ee,"Your Seat: "+u(x.value.value||"Not seated"),1)]),e("div",null,[e("span",Me,"Status: "+u(f.value.value),1),S.value?(n(),o("span",He,"Your Turn!")):v("",!0)])]),p.value?v("",!0):(n(),o("div",We,[e("button",{onClick:t[0]||(t[0]=l=>L.value=!0),class:"btn btn-primary",disabled:r.value||!ie.value}," Sit Down ",8,Ve),e("button",{onClick:t[1]||(t[1]=l=>C("STANDUP")),class:"btn btn-warning",disabled:r.value||!de.value}," Stand Up ",8,je),e("button",{onClick:me,class:"btn btn-success",disabled:r.value||!ce.value}," Start Game ",8,Ke)]))])]),e("div",Je,[e("div",ze,[t[16]||(t[16]=e("h5",null,"Your Hand",-1)),e("div",qe,[(N=w.value)!=null&&N.hand&&w.value.hand.length>0?(n(),o("div",Qe,[(n(!0),o(D,null,G(w.value.hand,(l,O)=>(n(),o("div",{key:O,class:"card",style:{width:"80px"}},[e("div",Xe,[e("div",{class:oe(["card-suit",{"text-danger":l.suit==="♥"||l.suit==="♦"}])},u(l.suit),3),e("div",Ze,u(l.rank),1)])]))),128))])):(n(),o("div",et,' Cards not revealed yet - click "Look Cards" to reveal '))])])]),e("div",tt,[e("div",st,[e("h5",null,"Community Cards ("+u(((H=(z=a.value)==null?void 0:z.communityCards)==null?void 0:H.length)||0)+"/5)",1),e("div",at,[(n(!0),o(D,null,G((Z=a.value)==null?void 0:Z.communityCards,(l,O)=>(n(),o("div",{key:O,class:"card me-2"},[e("div",lt,[e("div",{class:oe(["card-suit",{"text-danger":l.suit==="♥"||l.suit==="♦"}])},u(l.suit),3),e("div",nt,u(l.rank),1)])]))),128)),(n(!0),o(D,null,G(5-(((te=(ee=a.value)==null?void 0:ee.communityCards)==null?void 0:te.length)||0),l=>(n(),o("div",{key:"empty-"+l,class:"card me-2 empty-card"},[...t[17]||(t[17]=[e("div",{class:"card-body p-2"},null,-1)])]))),128))]),(se=a.value)!=null&&se.gamePhase?(n(),o("div",ot,[e("span",rt,u(be(a.value.gamePhase)),1)])):v("",!0)])]),e("div",ut,[e("div",it,[p.value?(n(),o("h5",dt,u(S.value?"Your Turn":`Waiting for Player ${a.value.currentTurnPlayerId}`),1)):(n(),o("h5",ct,"Game Lobby")),p.value&&w.value?(n(),o("div",vt,[e("p",mt,[t[18]||(t[18]=q("Your chips: ",-1)),e("strong",null,u(w.value.chips),1)]),e("p",yt,[t[19]||(t[19]=q("Current bet: ",-1)),e("strong",null,u(a.value.currentBet),1)]),e("p",bt,[t[20]||(t[20]=q("Pot: ",-1)),e("strong",null,u(a.value.pot),1)])])):v("",!0),e("div",pt,[p.value&&S.value?(n(),o("button",{key:0,onClick:t[2]||(t[2]=l=>C("FOLD")),class:"btn btn-outline-danger",disabled:r.value}," Fold ",8,ht)):v("",!0),p.value&&S.value&&a.value.currentBet===0?(n(),o("button",{key:1,onClick:t[3]||(t[3]=l=>C("CHECK")),class:"btn btn-outline-primary",disabled:r.value}," Check ",8,_t)):v("",!0),p.value&&S.value?(n(),o("button",{key:2,onClick:t[4]||(t[4]=l=>C("CALL")),class:"btn btn-primary",disabled:r.value}," Call ("+u(a.value.currentBet)+" chips) ",9,gt)):v("",!0),p.value&&S.value?(n(),o("button",{key:3,onClick:t[5]||(t[5]=l=>C("RAISE")),class:"btn btn-success",disabled:r.value}," Raise ",8,ft)):v("",!0),p.value&&S.value?(n(),o("button",{key:4,onClick:t[6]||(t[6]=l=>C("ALL_IN")),class:"btn btn-warning",disabled:r.value}," All In ",8,kt)):v("",!0),p.value&&S.value?(n(),o("button",{key:5,onClick:t[7]||(t[7]=l=>C("LOOK")),class:"btn btn-info",disabled:r.value}," Look Cards ",8,Ct)):v("",!0)]),E.value?(n(),o("div",St,[e("div",It,[le(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>F.value=l),type:"number",class:"form-control",placeholder:"Enter raise amount",min:"0"},null,512),[[ne,F.value]]),e("button",{onClick:pe,class:"btn btn-success",disabled:r.value}," Confirm Raise ",8,xt),e("button",{onClick:he,class:"btn btn-outline-secondary",disabled:r.value}," Cancel ",8,Bt)])])):v("",!0)])]),e("div",Pt,[e("div",Tt,[t[21]||(t[21]=e("h5",null,"Game Log",-1)),e("div",{class:"log-container",ref_key:"logContainer",ref:I},[(n(!0),o(D,null,G(P.value,(l,O)=>(n(),o("div",{key:O,class:"log-entry"},u(l),1))),128))],512)])])])):v("",!0),L.value?(n(),o("div",Lt,[e("div",wt,[e("div",Rt,[e("div",At,[t[22]||(t[22]=e("h5",{class:"modal-title"},"Select a Seat",-1)),e("button",{type:"button",class:"btn-close",onClick:t[9]||(t[9]=l=>L.value=!1)})]),e("div",Nt,[e("div",Ot,[e("div",Ut,[(n(!0),o(D,null,G(ue.value,l=>(n(),o("div",{key:l,class:"col-3 mb-3"},[e("button",{onClick:O=>ve(l),class:"btn btn-outline-primary w-100 seat-button",disabled:r.value}," Seat "+u(l),9,$t)]))),128))])])]),e("div",Ft,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=l=>L.value=!1)},"Cancel")])])])])):v("",!0),T.value?(n(),o("div",Dt,[e("div",Gt,[e("div",Yt,[e("div",Et,[e("h5",Mt,"Buy-In for Seat "+u(x.value),1),e("button",{type:"button",class:"btn-close",onClick:t[11]||(t[11]=l=>T.value=!1)})]),e("div",Ht,[e("div",Wt,[e("label",Vt,"Buy-In Amount ("+u($(g).minBuyIn)+"-"+u($(g).maxBuyIn)+" chips)",1),le(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>M.value=l),type:"number",class:"form-control",min:$(g).minBuyIn,max:$(g).maxBuyIn},null,8,jt),[[ne,M.value]])]),e("p",Kt," Small Blind: "+u($(g).smallBlind)+" chips | Big Blind: "+u($(g).bigBlind)+" chips ",1)]),e("div",Jt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=l=>T.value=!1)},"Cancel"),e("button",{type:"button",class:"btn btn-primary",onClick:t[14]||(t[14]=l=>C("SITDOWN")),disabled:r.value}," Confirm Buy-In ",8,zt)])])])])):v("",!0),L.value||T.value?(n(),o("div",qt)):v("",!0)])}}},ss=Ce(Qt,[["__scopeId","data-v-8ae39eec"]]);export{ss as default};
//# sourceMappingURL=GamePage-56e90346.js.map
