import{q as _e,s as he,u as ge,f as m,k as N,l as fe,x as Ce,y as Z,o as l,c as n,a as e,j as c,t as i,F as $,m as D,e as K,h as ee,v as se,z as O,p as te}from"./index-91592ea1.js";import{u as ae}from"./useApi-49c977da.js";import{u as ke}from"./useAuth-174606a9.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-78d57de0.js";const Se=_e("game",{state:()=>({currentUser:null,currentRoom:null,gameState:"LOBBY",players:[],communityCards:[],playerCards:[],currentTurn:0,pot:0,smallBlind:0,bigBlind:0,minBuyIn:0,maxBuyIn:0}),actions:{setUser(t){this.currentUser=t},clearUser(){this.currentUser=null},setRoom(t){this.currentRoom=t,this.smallBlind=t.sbet||0,this.bigBlind=t.bbet||0,this.minBuyIn=t.minbuy||0,this.maxBuyIn=t.maxbuy||0},clearRoom(){this.currentRoom=null,this.players=[],this.communityCards=[],this.playerCards=[],this.currentTurn=0,this.pot=0},setGameState(t){this.gameState=t},updatePlayer(t){const p=this.players.findIndex(I=>I.uid===t.uid);p>=0?this.players[p]=t:this.players.push(t)},removePlayer(t){this.players=this.players.filter(p=>p.uid!==t)},setCommunityCards(t){this.communityCards=t},addCommunityCard(t){this.communityCards.push(t)},setPlayerCards(t){this.playerCards=t},setTurn(t){this.currentTurn=t},setPot(t){this.pot=t},resetGame(){this.gameState="LOBBY",this.communityCards=[],this.playerCards=[],this.currentTurn=0,this.pot=0}},getters:{isPlayerTurn:t=>{var p;return t.currentTurn===((p=t.currentUser)==null?void 0:p.uid)},currentPlayer:t=>t.players.find(p=>{var I;return p.uid===((I=t.currentUser)==null?void 0:I.uid)}),isInRoom:t=>t.currentRoom!==null,isGameInProgress:t=>t.gameState==="PLAYING"}});const xe={class:"game-page container mt-4"},Be={key:0,class:"text-center my-5"},Pe={key:1,class:"alert alert-danger"},Te={key:2,class:"game-container"},Le={class:"game-header card mb-4"},Re={class:"card-body"},we={class:"d-flex justify-content-between align-items-center"},Ae={class:"mb-0"},Ne={class:"text-muted mb-0"},Oe=["disabled"],Ue={class:"game-status card mb-4"},$e={class:"card-body"},De={class:"d-flex justify-content-between align-items-center mb-3"},Ge={class:"mb-0"},Fe={class:"mb-0"},Ye={class:"mb-0"},Ee={class:"mb-0"},Me={class:"badge bg-primary me-2"},He={key:0,class:"badge bg-success"},We={key:0,class:"lobby-actions d-flex gap-2"},Ve=["disabled"],je=["disabled"],Ke=["disabled"],ze={class:"player-hand card mb-4"},qe={class:"card-body"},Je={class:"hand-cards d-flex justify-content-center"},Qe={key:0,class:"d-flex gap-3"},Xe={class:"card-body p-2 text-center"},Ze={class:"card-rank"},es={key:1,class:"text-muted"},ss={class:"community-cards card mb-4"},ts={class:"card-body"},as={class:"community-cards-container d-flex justify-content-center"},ls={class:"card-body p-2 text-center"},ns={class:"card-rank"},os={key:0,class:"text-center mt-2"},is={class:"badge bg-info"},us={class:"player-actions card mb-4"},ds={class:"card-body"},rs={key:0},cs={key:1},vs={key:2,class:"player-info mb-3"},ms={class:"mb-0"},bs={class:"mb-0"},ys={class:"mb-0"},ps={class:"action-buttons d-flex justify-content-center gap-2"},_s=["disabled"],hs=["disabled"],gs=["disabled"],fs=["disabled"],Cs=["disabled"],ks=["disabled"],Is={key:3,class:"mt-3"},Ss={class:"input-group"},xs=["disabled"],Bs=["disabled"],Ps={class:"game-log card"},Ts={class:"card-body"},Ls={key:3,class:"modal fade show",style:{display:"block"},tabindex:"-1"},Rs={class:"modal-dialog"},ws={class:"modal-content"},As={class:"modal-header"},Ns={class:"modal-body"},Os={class:"seat-grid"},Us={class:"row"},$s=["onClick","disabled"],Ds={class:"modal-footer"},Gs={key:4,class:"modal fade show",style:{display:"block"},tabindex:"-1"},Fs={class:"modal-dialog"},Ys={class:"modal-content"},Es={class:"modal-header"},Ms={class:"modal-title"},Hs={class:"modal-body"},Ws={class:"mb-3"},Vs={class:"form-label"},js=["min","max"],Ks={class:"text-muted"},zs={class:"modal-footer"},qs=["disabled"],Js={key:5,class:"modal-backdrop fade show"},Qs={__name:"GamePage",setup(t){const{getUserProfile:p,gameAction:I,leaveRoom:le,getRoomInfo:Xs}=ae(),{getCurrentUser:ne,user:H}=ke(),G=he(),oe=ge(),_=Se(),r=m(!1),y=m(""),o=m(null),g=m({}),F=m(!1),U=m(0),B=m([]),S=m(null),x=m(null),h=m("spectator"),Y=m(1e3),P=m(!1),T=m(!1),ie=m([1,2,3,4,5,6,7,8]);let W=null;const C=N(()=>o.value&&o.value.currentTurnPlayerId===g.value.uid),L=N(()=>{var u,s;return(s=(u=o.value)==null?void 0:u.players)==null?void 0:s.find(d=>d.id===g.value.uid)}),b=N(()=>o.value&&o.value.gamePhase&&o.value.gamePhase!=="LOBBY"),ue=N(()=>h.value==="spectator"&&!b.value),de=N(()=>h.value==="sitting"&&!b.value),re=N(()=>h.value==="sitting"&&!b.value);fe(async()=>{await V(),W=setInterval(V,5e3)}),Ce(()=>{W&&clearInterval(W)});const V=async()=>{var u,s;try{if(r.value=!0,y.value="",await ne(),H.value)g.value=H.value,_.setUser(H.value),console.log("Loaded user from Pinia auth store:",g.value);else{const v=await p();v.data&&(g.value=v.data,_.setUser(v.data))}const d=await ae().get(`/api/v1/game/${G.params.roomId}/state`);if(d.data&&d.data.success){o.value=d.data.data,_.setRoom({roomid:o.value.room.roomid,name:o.value.room.name,sbet:50,bbet:100,minbuy:500,maxbuy:5e3});const v=o.value.players.find(k=>k.id===g.value.uid);v&&(g.value={...g.value,...v},x.value=v.seatId,h.value=v.seatId>=0?"sitting":"spectator",h.value==="sitting"&&b.value&&(h.value="playing")),z(`Game state updated - ${o.value.gamePhase||"LOBBY"} phase`)}}catch(d){y.value="Failed to load game state: "+(((s=(u=d.response)==null?void 0:u.data)==null?void 0:s.message)||d.message)}finally{r.value=!1}},z=u=>{B.value.push(u),B.value.length>50&&(B.value=B.value.slice(-50)),Z(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})},f=async u=>{var s,d,v;try{if(r.value=!0,y.value="",u==="RAISE"){F.value=!0;return}const E={FOLD:"4",CHECK:"2",CALL:"3",RAISE:"2",ALL_IN:"5",LOOK:"1",SITDOWN:"6",STANDUP:"7",START:"sbot",LEAVE:"8"}[u],R={};u==="SITDOWN"&&(R.sid=x.value,R.cb=Y.value);const w=await I(G.params.roomId,E,R);if(w.data&&w.data.success){const M={FOLD:"folded",CHECK:"checked",CALL:`called (${o.value.currentBet} chips)`,ALL_IN:"went all-in",LOOK:"looked at cards",SITDOWN:`sat down at seat ${x.value} with ${Y.value} chips`,STANDUP:"stood up from the table",START:"started the game"}[u]||u;z(`You ${M}`),u==="SITDOWN"?(h.value="sitting",P.value=!1):u==="STANDUP"?(h.value="spectator",x.value=null):u==="START"&&(h.value="playing"),await V()}else y.value="Failed to perform action: "+(((s=w.data)==null?void 0:s.message)||"Unknown error")}catch(k){y.value="Failed to perform action: "+(((v=(d=k.response)==null?void 0:d.data)==null?void 0:v.message)||k.message)}finally{r.value=!1}},ce=u=>{x.value=u,T.value=!1,P.value=!0},ve=async()=>{await f("START")},me=async()=>{var u,s;try{r.value=!0,y.value="";const d=await le(G.params.roomId);_.clearRoom(),oe.push({name:"rooms"})}catch(d){y.value="Failed to leave room: "+(((s=(u=d.response)==null?void 0:u.data)==null?void 0:s.message)||d.message)}finally{r.value=!1}},be=u=>({PRE_FLOP:"Pre-Flop",FLOP:"Flop",TURN:"Turn",RIVER:"River",SHOWDOWN:"Showdown",LOBBY:"Lobby"})[u]||u,ye=async()=>{var u,s;try{r.value=!0,y.value="";const d=parseInt(U.value);if(isNaN(d)||d<=0){y.value="Please enter a valid raise amount";return}const v=await I(G.params.roomId,"RAISE",{amount:d});B.value.push(`You raised to ${d} chips`),F.value=!1,U.value=0,await Z(),S.value&&(S.value.scrollTop=S.value.scrollHeight)}catch(d){y.value="Failed to raise: "+(((s=(u=d.response)==null?void 0:u.data)==null?void 0:s.message)||d.message)}finally{r.value=!1}},pe=()=>{F.value=!1,U.value=0};return(u,s)=>{var d,v,k,E,R,w,j,M,q,J,Q,X;return l(),n("div",xe,[r.value?(l(),n("div",Be,[...s[15]||(s[15]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-3"},"Loading game...",-1)])])):c("",!0),y.value?(l(),n("div",Pe,i(y.value),1)):c("",!0),!r.value&&o.value?(l(),n("div",Te,[e("div",Le,[e("div",Re,[e("div",we,[e("div",null,[e("h2",Ae,i(o.value.room.name),1),e("p",Ne,i(o.value.room.roomTypeName)+" | Players: "+i(o.value.room.getPlayerCount())+" / "+i(o.value.room.maxPlayers),1)]),e("div",null,[e("button",{onClick:me,class:"btn btn-danger",disabled:r.value}," Leave Room ",8,Oe)])])])]),e("div",Ue,[e("div",$e,[e("div",De,[e("div",null,[e("h5",null,"Current Hand: "+i(((d=o.value)==null?void 0:d.currentHand)||"N/A"),1),e("p",Ge,"Pot: "+i(((v=o.value)==null?void 0:v.pot)||0)+" chips",1),e("p",Fe,"Game Phase: "+i(((k=o.value)==null?void 0:k.gamePhase)||"LOBBY"),1)]),e("div",null,[e("h5",null,"Current Bet: "+i(((E=o.value)==null?void 0:E.currentBet)||0)+" chips",1),e("p",Ye,"Your Chips: "+i(((R=L.value)==null?void 0:R.chips)||g.value.allMoney||0),1),e("p",Ee,"Your Seat: "+i(x.value.value||"Not seated"),1)]),e("div",null,[e("span",Me,"Status: "+i(h.value.value),1),C.value?(l(),n("span",He,"Your Turn!")):c("",!0)])]),b.value?c("",!0):(l(),n("div",We,[e("button",{onClick:s[0]||(s[0]=a=>T.value=!0),class:"btn btn-primary",disabled:r.value||!ue.value}," Sit Down ",8,Ve),e("button",{onClick:s[1]||(s[1]=a=>f("STANDUP")),class:"btn btn-warning",disabled:r.value||!de.value}," Stand Up ",8,je),e("button",{onClick:ve,class:"btn btn-success",disabled:r.value||!re.value}," Start Game ",8,Ke)]))])]),e("div",ze,[e("div",qe,[s[16]||(s[16]=e("h5",null,"Your Hand",-1)),e("div",Je,[(w=L.value)!=null&&w.hand&&L.value.hand.length>0?(l(),n("div",Qe,[(l(!0),n($,null,D(L.value.hand,(a,A)=>(l(),n("div",{key:A,class:"card",style:{width:"80px"}},[e("div",Xe,[e("div",{class:te(["card-suit",{"text-danger":a.suit==="♥"||a.suit==="♦"}])},i(a.suit),3),e("div",Ze,i(a.rank),1)])]))),128))])):(l(),n("div",es,' Cards not revealed yet - click "Look Cards" to reveal '))])])]),e("div",ss,[e("div",ts,[e("h5",null,"Community Cards ("+i(((M=(j=o.value)==null?void 0:j.communityCards)==null?void 0:M.length)||0)+"/5)",1),e("div",as,[(l(!0),n($,null,D((q=o.value)==null?void 0:q.communityCards,(a,A)=>(l(),n("div",{key:A,class:"card me-2"},[e("div",ls,[e("div",{class:te(["card-suit",{"text-danger":a.suit==="♥"||a.suit==="♦"}])},i(a.suit),3),e("div",ns,i(a.rank),1)])]))),128)),(l(!0),n($,null,D(5-(((Q=(J=o.value)==null?void 0:J.communityCards)==null?void 0:Q.length)||0),a=>(l(),n("div",{key:"empty-"+a,class:"card me-2 empty-card"},[...s[17]||(s[17]=[e("div",{class:"card-body p-2"},null,-1)])]))),128))]),(X=o.value)!=null&&X.gamePhase?(l(),n("div",os,[e("span",is,i(be(o.value.gamePhase)),1)])):c("",!0)])]),e("div",us,[e("div",ds,[b.value?(l(),n("h5",rs,i(C.value?"Your Turn":`Waiting for Player ${o.value.currentTurnPlayerId}`),1)):(l(),n("h5",cs,"Game Lobby")),b.value&&L.value?(l(),n("div",vs,[e("p",ms,[s[18]||(s[18]=K("Your chips: ",-1)),e("strong",null,i(L.value.chips),1)]),e("p",bs,[s[19]||(s[19]=K("Current bet: ",-1)),e("strong",null,i(o.value.currentBet),1)]),e("p",ys,[s[20]||(s[20]=K("Pot: ",-1)),e("strong",null,i(o.value.pot),1)])])):c("",!0),e("div",ps,[b.value&&C.value?(l(),n("button",{key:0,onClick:s[2]||(s[2]=a=>f("FOLD")),class:"btn btn-outline-danger",disabled:r.value}," Fold ",8,_s)):c("",!0),b.value&&C.value&&o.value.currentBet===0?(l(),n("button",{key:1,onClick:s[3]||(s[3]=a=>f("CHECK")),class:"btn btn-outline-primary",disabled:r.value}," Check ",8,hs)):c("",!0),b.value&&C.value?(l(),n("button",{key:2,onClick:s[4]||(s[4]=a=>f("CALL")),class:"btn btn-primary",disabled:r.value}," Call ("+i(o.value.currentBet)+" chips) ",9,gs)):c("",!0),b.value&&C.value?(l(),n("button",{key:3,onClick:s[5]||(s[5]=a=>f("RAISE")),class:"btn btn-success",disabled:r.value}," Raise ",8,fs)):c("",!0),b.value&&C.value?(l(),n("button",{key:4,onClick:s[6]||(s[6]=a=>f("ALL_IN")),class:"btn btn-warning",disabled:r.value}," All In ",8,Cs)):c("",!0),b.value&&C.value?(l(),n("button",{key:5,onClick:s[7]||(s[7]=a=>f("LOOK")),class:"btn btn-info",disabled:r.value}," Look Cards ",8,ks)):c("",!0)]),F.value?(l(),n("div",Is,[e("div",Ss,[ee(e("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>U.value=a),type:"number",class:"form-control",placeholder:"Enter raise amount",min:"0"},null,512),[[se,U.value]]),e("button",{onClick:ye,class:"btn btn-success",disabled:r.value}," Confirm Raise ",8,xs),e("button",{onClick:pe,class:"btn btn-outline-secondary",disabled:r.value}," Cancel ",8,Bs)])])):c("",!0)])]),e("div",Ps,[e("div",Ts,[s[21]||(s[21]=e("h5",null,"Game Log",-1)),e("div",{class:"log-container",ref_key:"logContainer",ref:S},[(l(!0),n($,null,D(B.value,(a,A)=>(l(),n("div",{key:A,class:"log-entry"},i(a),1))),128))],512)])])])):c("",!0),T.value?(l(),n("div",Ls,[e("div",Rs,[e("div",ws,[e("div",As,[s[22]||(s[22]=e("h5",{class:"modal-title"},"Select a Seat",-1)),e("button",{type:"button",class:"btn-close",onClick:s[9]||(s[9]=a=>T.value=!1)})]),e("div",Ns,[e("div",Os,[e("div",Us,[(l(!0),n($,null,D(ie.value,a=>(l(),n("div",{key:a,class:"col-3 mb-3"},[e("button",{onClick:A=>ce(a),class:"btn btn-outline-primary w-100 seat-button",disabled:r.value}," Seat "+i(a),9,$s)]))),128))])])]),e("div",Ds,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[10]||(s[10]=a=>T.value=!1)},"Cancel")])])])])):c("",!0),P.value?(l(),n("div",Gs,[e("div",Fs,[e("div",Ys,[e("div",Es,[e("h5",Ms,"Buy-In for Seat "+i(x.value),1),e("button",{type:"button",class:"btn-close",onClick:s[11]||(s[11]=a=>P.value=!1)})]),e("div",Hs,[e("div",Ws,[e("label",Vs,"Buy-In Amount ("+i(O(_).minBuyIn)+"-"+i(O(_).maxBuyIn)+" chips)",1),ee(e("input",{"onUpdate:modelValue":s[12]||(s[12]=a=>Y.value=a),type:"number",class:"form-control",min:O(_).minBuyIn,max:O(_).maxBuyIn},null,8,js),[[se,Y.value]])]),e("p",Ks," Small Blind: "+i(O(_).smallBlind)+" chips | Big Blind: "+i(O(_).bigBlind)+" chips ",1)]),e("div",zs,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[13]||(s[13]=a=>P.value=!1)},"Cancel"),e("button",{type:"button",class:"btn btn-primary",onClick:s[14]||(s[14]=a=>f("SITDOWN")),disabled:r.value}," Confirm Buy-In ",8,qs)])])])])):c("",!0),T.value||P.value?(l(),n("div",Js)):c("",!0)])}}},lt=Ie(Qs,[["__scopeId","data-v-d64d2955"]]);export{lt as default};
//# sourceMappingURL=GamePage-8932509d.js.map
