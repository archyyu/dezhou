import{q as _e,u as pe,f as v,k as A,l as ye,s as he,x as J,o as a,c as l,a as e,j as r,t as n,F as O,m as $,e as H,h as Q,v as X,y as R,p as Z}from"./index-e3c589d7.js";import{u as ee}from"./useApi-0fdb8b38.js";import{u as ge,a as fe}from"./useAuth-6eda7b06.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-78d57de0.js";const Ce={class:"game-page container mt-4"},Se={key:0,class:"text-center my-5"},Ie={key:1,class:"alert alert-danger"},xe={key:2,class:"game-container"},Le={class:"game-header card mb-4"},we={class:"card-body"},Pe={class:"d-flex justify-content-between align-items-center"},Te={class:"mb-0"},Be={class:"text-muted mb-0"},Ae=["disabled"],Re={class:"game-status card mb-4"},Ne={class:"card-body"},Oe={class:"d-flex justify-content-between align-items-center mb-3"},$e={class:"mb-0"},De={class:"mb-0"},Ue={class:"mb-0"},Fe={class:"mb-0"},Ge={class:"badge bg-primary me-2"},Ee={key:0,class:"badge bg-success"},Ye={key:0,class:"lobby-actions d-flex gap-2"},Me=["disabled"],He=["disabled"],We=["disabled"],Ve={class:"player-hand card mb-4"},je={class:"card-body"},Ke={class:"hand-cards d-flex justify-content-center"},qe={key:0,class:"d-flex gap-3"},ze={class:"card-body p-2 text-center"},Je={class:"card-rank"},Qe={key:1,class:"text-muted"},Xe={class:"community-cards card mb-4"},Ze={class:"card-body"},es={class:"community-cards-container d-flex justify-content-center"},ss={class:"card-body p-2 text-center"},ts={class:"card-rank"},as={key:0,class:"text-center mt-2"},ls={class:"badge bg-info"},os={class:"player-actions card mb-4"},ns={class:"card-body"},ds={key:0},is={key:1},us={key:2,class:"player-info mb-3"},rs={class:"mb-0"},cs={class:"mb-0"},vs={class:"mb-0"},ms={class:"action-buttons d-flex justify-content-center gap-2"},bs=["disabled"],_s=["disabled"],ps=["disabled"],ys=["disabled"],hs=["disabled"],gs=["disabled"],fs={key:3,class:"mt-3"},ks={class:"input-group"},Cs=["disabled"],Ss=["disabled"],Is={class:"game-log card"},xs={class:"card-body"},Ls={key:3,class:"modal fade show",style:{display:"block"},tabindex:"-1"},ws={class:"modal-dialog"},Ps={class:"modal-content"},Ts={class:"modal-header"},Bs={class:"modal-body"},As={class:"seat-grid"},Rs={class:"row"},Ns=["onClick","disabled"],Os={class:"modal-footer"},$s={key:4,class:"modal fade show",style:{display:"block"},tabindex:"-1"},Ds={class:"modal-dialog"},Us={class:"modal-content"},Fs={class:"modal-header"},Gs={class:"modal-title"},Es={class:"modal-body"},Ys={class:"mb-3"},Ms={class:"form-label"},Hs=["min","max"],Ws={class:"text-muted"},Vs={class:"modal-footer"},js=["disabled"],Ks={key:5,class:"modal-backdrop fade show"},qs={__name:"GamePage",setup(zs){const{getUserProfile:se,gameAction:W,leaveRoom:te,getRoomInfo:Js}=ee(),{getCurrentUser:ae}=ge(),D=_e(),le=pe(),_=fe(),i=v(!1),b=v(""),o=v(null),h=v({}),U=v(!1),N=v(0),S=v([]),k=v(null),C=v(null),p=v("spectator"),F=v(1e3),I=v(!1),x=v(!1),oe=v([1,2,3,4,5,6,7,8]);let E=null;const f=A(()=>o.value&&o.value.currentTurnPlayerId===h.value.uid),L=A(()=>{var d,s;return(s=(d=o.value)==null?void 0:d.players)==null?void 0:s.find(u=>u.id===h.value.uid)}),m=A(()=>o.value&&o.value.gamePhase&&o.value.gamePhase!=="LOBBY"),ne=A(()=>p.value==="spectator"&&!m.value),de=A(()=>p.value==="sitting"&&!m.value),ie=A(()=>p.value==="sitting"&&!m.value);ye(async()=>{await Y(),E=setInterval(Y,5e3)}),he(()=>{E&&clearInterval(E)});const Y=async()=>{var d,s;try{if(i.value=!0,b.value="",await ae())h.value=_.currentUser,console.log("Loaded user from Pinia store:",h.value);else{const c=await se();h.value=c.data,_.setUser(c.data)}const y=await ee().get(`/api/v1/game/${D.params.roomId}/state`);if(y.data&&y.data.success){o.value=y.data.data,_.setRoom({roomid:o.value.room.roomid,name:o.value.room.name,sbet:50,bbet:100,minbuy:500,maxbuy:5e3});const c=o.value.players.find(w=>w.id===h.value.uid);c&&(h.value={...h.value,...c},C.value=c.seatId,p.value=c.seatId>=0?"sitting":"spectator",p.value==="sitting"&&m.value&&(p.value="playing")),V(`Game state updated - ${o.value.gamePhase||"LOBBY"} phase`)}}catch(u){b.value="Failed to load game state: "+(((s=(d=u.response)==null?void 0:d.data)==null?void 0:s.message)||u.message)}finally{i.value=!1}},V=d=>{S.value.push(d),S.value.length>50&&(S.value=S.value.slice(-50)),J(()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)})},g=async d=>{var s,u,y;try{if(i.value=!0,b.value="",d==="RAISE"){U.value=!0;return}const w={FOLD:"4",CHECK:"2",CALL:"3",RAISE:"2",ALL_IN:"5",LOOK:"1",SITDOWN:"6",STANDUP:"7",START:"sbot",LEAVE:"8"}[d],P={};d==="SITDOWN"&&(P.sid=C.value,P.cb=F.value);const T=await W(D.params.roomId,w,P);if(T.data&&T.data.success){const G={FOLD:"folded",CHECK:"checked",CALL:`called (${o.value.currentBet} chips)`,ALL_IN:"went all-in",LOOK:"looked at cards",SITDOWN:`sat down at seat ${C.value} with ${F.value} chips`,STANDUP:"stood up from the table",START:"started the game"}[d]||d;V(`You ${G}`),d==="SITDOWN"?(p.value="sitting",I.value=!1):d==="STANDUP"?(p.value="spectator",C.value=null):d==="START"&&(p.value="playing"),await Y()}else b.value="Failed to perform action: "+(((s=T.data)==null?void 0:s.message)||"Unknown error")}catch(c){b.value="Failed to perform action: "+(((y=(u=c.response)==null?void 0:u.data)==null?void 0:y.message)||c.message)}finally{i.value=!1}},ue=d=>{C.value=d,x.value=!1,I.value=!0},re=async()=>{await g("START")},ce=async()=>{var d,s;try{i.value=!0,b.value="";const u=await te(D.params.roomId);_.clearRoom(),le.push({name:"rooms"})}catch(u){b.value="Failed to leave room: "+(((s=(d=u.response)==null?void 0:d.data)==null?void 0:s.message)||u.message)}finally{i.value=!1}},ve=d=>({PRE_FLOP:"Pre-Flop",FLOP:"Flop",TURN:"Turn",RIVER:"River",SHOWDOWN:"Showdown",LOBBY:"Lobby"})[d]||d,me=async()=>{var d,s;try{i.value=!0,b.value="";const u=parseInt(N.value);if(isNaN(u)||u<=0){b.value="Please enter a valid raise amount";return}const y=await W(D.params.roomId,"RAISE",{amount:u});S.value.push(`You raised to ${u} chips`),U.value=!1,N.value=0,await J(),k.value&&(k.value.scrollTop=k.value.scrollHeight)}catch(u){b.value="Failed to raise: "+(((s=(d=u.response)==null?void 0:d.data)==null?void 0:s.message)||u.message)}finally{i.value=!1}},be=()=>{U.value=!1,N.value=0};return(d,s)=>{var u,y,c,w,P,T,M,G,j,K,q,z;return a(),l("div",Ce,[i.value?(a(),l("div",Se,[...s[15]||(s[15]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-3"},"Loading game...",-1)])])):r("",!0),b.value?(a(),l("div",Ie,n(b.value),1)):r("",!0),!i.value&&o.value?(a(),l("div",xe,[e("div",Le,[e("div",we,[e("div",Pe,[e("div",null,[e("h2",Te,n(o.value.room.name),1),e("p",Be,n(o.value.room.roomTypeName)+" | Players: "+n(o.value.room.getPlayerCount())+" / "+n(o.value.room.maxPlayers),1)]),e("div",null,[e("button",{onClick:ce,class:"btn btn-danger",disabled:i.value}," Leave Room ",8,Ae)])])])]),e("div",Re,[e("div",Ne,[e("div",Oe,[e("div",null,[e("h5",null,"Current Hand: "+n(((u=o.value)==null?void 0:u.currentHand)||"N/A"),1),e("p",$e,"Pot: "+n(((y=o.value)==null?void 0:y.pot)||0)+" chips",1),e("p",De,"Game Phase: "+n(((c=o.value)==null?void 0:c.gamePhase)||"LOBBY"),1)]),e("div",null,[e("h5",null,"Current Bet: "+n(((w=o.value)==null?void 0:w.currentBet)||0)+" chips",1),e("p",Ue,"Your Chips: "+n(((P=L.value)==null?void 0:P.chips)||h.value.allMoney||0),1),e("p",Fe,"Your Seat: "+n(C.value.value||"Not seated"),1)]),e("div",null,[e("span",Ge,"Status: "+n(p.value.value),1),f.value?(a(),l("span",Ee,"Your Turn!")):r("",!0)])]),m.value?r("",!0):(a(),l("div",Ye,[e("button",{onClick:s[0]||(s[0]=t=>x.value=!0),class:"btn btn-primary",disabled:i.value||!ne.value}," Sit Down ",8,Me),e("button",{onClick:s[1]||(s[1]=t=>g("STANDUP")),class:"btn btn-warning",disabled:i.value||!de.value}," Stand Up ",8,He),e("button",{onClick:re,class:"btn btn-success",disabled:i.value||!ie.value}," Start Game ",8,We)]))])]),e("div",Ve,[e("div",je,[s[16]||(s[16]=e("h5",null,"Your Hand",-1)),e("div",Ke,[(T=L.value)!=null&&T.hand&&L.value.hand.length>0?(a(),l("div",qe,[(a(!0),l(O,null,$(L.value.hand,(t,B)=>(a(),l("div",{key:B,class:"card",style:{width:"80px"}},[e("div",ze,[e("div",{class:Z(["card-suit",{"text-danger":t.suit==="♥"||t.suit==="♦"}])},n(t.suit),3),e("div",Je,n(t.rank),1)])]))),128))])):(a(),l("div",Qe,' Cards not revealed yet - click "Look Cards" to reveal '))])])]),e("div",Xe,[e("div",Ze,[e("h5",null,"Community Cards ("+n(((G=(M=o.value)==null?void 0:M.communityCards)==null?void 0:G.length)||0)+"/5)",1),e("div",es,[(a(!0),l(O,null,$((j=o.value)==null?void 0:j.communityCards,(t,B)=>(a(),l("div",{key:B,class:"card me-2"},[e("div",ss,[e("div",{class:Z(["card-suit",{"text-danger":t.suit==="♥"||t.suit==="♦"}])},n(t.suit),3),e("div",ts,n(t.rank),1)])]))),128)),(a(!0),l(O,null,$(5-(((q=(K=o.value)==null?void 0:K.communityCards)==null?void 0:q.length)||0),t=>(a(),l("div",{key:"empty-"+t,class:"card me-2 empty-card"},[...s[17]||(s[17]=[e("div",{class:"card-body p-2"},null,-1)])]))),128))]),(z=o.value)!=null&&z.gamePhase?(a(),l("div",as,[e("span",ls,n(ve(o.value.gamePhase)),1)])):r("",!0)])]),e("div",os,[e("div",ns,[m.value?(a(),l("h5",ds,n(f.value?"Your Turn":`Waiting for Player ${o.value.currentTurnPlayerId}`),1)):(a(),l("h5",is,"Game Lobby")),m.value&&L.value?(a(),l("div",us,[e("p",rs,[s[18]||(s[18]=H("Your chips: ",-1)),e("strong",null,n(L.value.chips),1)]),e("p",cs,[s[19]||(s[19]=H("Current bet: ",-1)),e("strong",null,n(o.value.currentBet),1)]),e("p",vs,[s[20]||(s[20]=H("Pot: ",-1)),e("strong",null,n(o.value.pot),1)])])):r("",!0),e("div",ms,[m.value&&f.value?(a(),l("button",{key:0,onClick:s[2]||(s[2]=t=>g("FOLD")),class:"btn btn-outline-danger",disabled:i.value}," Fold ",8,bs)):r("",!0),m.value&&f.value&&o.value.currentBet===0?(a(),l("button",{key:1,onClick:s[3]||(s[3]=t=>g("CHECK")),class:"btn btn-outline-primary",disabled:i.value}," Check ",8,_s)):r("",!0),m.value&&f.value?(a(),l("button",{key:2,onClick:s[4]||(s[4]=t=>g("CALL")),class:"btn btn-primary",disabled:i.value}," Call ("+n(o.value.currentBet)+" chips) ",9,ps)):r("",!0),m.value&&f.value?(a(),l("button",{key:3,onClick:s[5]||(s[5]=t=>g("RAISE")),class:"btn btn-success",disabled:i.value}," Raise ",8,ys)):r("",!0),m.value&&f.value?(a(),l("button",{key:4,onClick:s[6]||(s[6]=t=>g("ALL_IN")),class:"btn btn-warning",disabled:i.value}," All In ",8,hs)):r("",!0),m.value&&f.value?(a(),l("button",{key:5,onClick:s[7]||(s[7]=t=>g("LOOK")),class:"btn btn-info",disabled:i.value}," Look Cards ",8,gs)):r("",!0)]),U.value?(a(),l("div",fs,[e("div",ks,[Q(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>N.value=t),type:"number",class:"form-control",placeholder:"Enter raise amount",min:"0"},null,512),[[X,N.value]]),e("button",{onClick:me,class:"btn btn-success",disabled:i.value}," Confirm Raise ",8,Cs),e("button",{onClick:be,class:"btn btn-outline-secondary",disabled:i.value}," Cancel ",8,Ss)])])):r("",!0)])]),e("div",Is,[e("div",xs,[s[21]||(s[21]=e("h5",null,"Game Log",-1)),e("div",{class:"log-container",ref_key:"logContainer",ref:k},[(a(!0),l(O,null,$(S.value,(t,B)=>(a(),l("div",{key:B,class:"log-entry"},n(t),1))),128))],512)])])])):r("",!0),x.value?(a(),l("div",Ls,[e("div",ws,[e("div",Ps,[e("div",Ts,[s[22]||(s[22]=e("h5",{class:"modal-title"},"Select a Seat",-1)),e("button",{type:"button",class:"btn-close",onClick:s[9]||(s[9]=t=>x.value=!1)})]),e("div",Bs,[e("div",As,[e("div",Rs,[(a(!0),l(O,null,$(oe.value,t=>(a(),l("div",{key:t,class:"col-3 mb-3"},[e("button",{onClick:B=>ue(t),class:"btn btn-outline-primary w-100 seat-button",disabled:i.value}," Seat "+n(t),9,Ns)]))),128))])])]),e("div",Os,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[10]||(s[10]=t=>x.value=!1)},"Cancel")])])])])):r("",!0),I.value?(a(),l("div",$s,[e("div",Ds,[e("div",Us,[e("div",Fs,[e("h5",Gs,"Buy-In for Seat "+n(C.value),1),e("button",{type:"button",class:"btn-close",onClick:s[11]||(s[11]=t=>I.value=!1)})]),e("div",Es,[e("div",Ys,[e("label",Ms,"Buy-In Amount ("+n(R(_).minBuyIn)+"-"+n(R(_).maxBuyIn)+" chips)",1),Q(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>F.value=t),type:"number",class:"form-control",min:R(_).minBuyIn,max:R(_).maxBuyIn},null,8,Hs),[[X,F.value]])]),e("p",Ws," Small Blind: "+n(R(_).smallBlind)+" chips | Big Blind: "+n(R(_).bigBlind)+" chips ",1)]),e("div",Vs,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[13]||(s[13]=t=>I.value=!1)},"Cancel"),e("button",{type:"button",class:"btn btn-primary",onClick:s[14]||(s[14]=t=>g("SITDOWN")),disabled:i.value}," Confirm Buy-In ",8,js)])])])])):r("",!0),x.value||I.value?(a(),l("div",Ks)):r("",!0)])}}},tt=ke(qs,[["__scopeId","data-v-f5f1b73d"]]);export{tt as default};
//# sourceMappingURL=GamePage-e90d7f3e.js.map
