import{u as b,f as d,r as w,o as l,c as i,a as t,g as y,h as c,v as m,i as k,t as h,j as x,e as p,b as L,w as S}from"./index-e3c589d7.js";import{u as N}from"./useApi-0fdb8b38.js";import{u as V}from"./useAuth-6eda7b06.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-78d57de0.js";const C={class:"login-page"},J={class:"row justify-content-center"},O={class:"col-md-6 col-lg-4"},P={class:"card shadow"},U={class:"card-body p-4"},A={class:"mb-3"},B={class:"mb-3"},D={class:"mb-3 form-check"},M=["disabled"],R={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},j={key:1},q={key:0,class:"alert alert-danger mt-3"},E={class:"text-center mt-3"},T={class:"mb-0"},z={__name:"LoginPage",setup(F){const f=b(),{login:v}=N(),{getCurrentUser:u}=V(),o=d({account:"",password:"",remember:!1}),n=d(!1),a=d(""),g=async()=>{try{n.value=!0,a.value="";const e=await v({name:o.value.account,password:o.value.password});if(console.log("Login response:",e.data),e.data&&e.data.success&&e.data.data)localStorage.setItem("token",e.data.data.token),localStorage.setItem("user",JSON.stringify(e.data.data.user)),await u();else if(e.data&&e.data.token)localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),await u();else throw new Error("Invalid response format: "+JSON.stringify(e.data));f.push("/rooms")}catch(e){console.error("Login error:",e),e.response&&e.response.data?a.value=e.response.data.message||"Login failed: "+JSON.stringify(e.response.data):e.message?a.value=e.message:a.value="Login failed: "+e}finally{n.value=!1}};return(e,s)=>{const _=w("router-link");return l(),i("div",C,[t("div",J,[t("div",O,[t("div",P,[t("div",U,[s[8]||(s[8]=t("h2",{class:"card-title text-center mb-4"},"Login",-1)),t("form",{onSubmit:y(g,["prevent"])},[t("div",A,[s[3]||(s[3]=t("label",{for:"account",class:"form-label"},"Account",-1)),c(t("input",{type:"text",class:"form-control",id:"account","onUpdate:modelValue":s[0]||(s[0]=r=>o.value.account=r),required:""},null,512),[[m,o.value.account]])]),t("div",B,[s[4]||(s[4]=t("label",{for:"password",class:"form-label"},"Password",-1)),c(t("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":s[1]||(s[1]=r=>o.value.password=r),required:""},null,512),[[m,o.value.password]])]),t("div",D,[c(t("input",{type:"checkbox",class:"form-check-input",id:"remember","onUpdate:modelValue":s[2]||(s[2]=r=>o.value.remember=r)},null,512),[[k,o.value.remember]]),s[5]||(s[5]=t("label",{class:"form-check-label",for:"remember"},"Remember me",-1))]),t("button",{type:"submit",class:"btn btn-primary w-100",disabled:n.value},[n.value?(l(),i("span",R)):(l(),i("span",j,"Login"))],8,M),a.value?(l(),i("div",q,h(a.value),1)):x("",!0)],32),t("div",E,[t("p",T,[s[7]||(s[7]=p("Don't have an account? ",-1)),L(_,{to:"/register"},{default:S(()=>[...s[6]||(s[6]=[p("Register",-1)])]),_:1})])])])])])])])}}},X=I(z,[["__scopeId","data-v-fb176c9a"]]);export{X as default};
//# sourceMappingURL=LoginPage-1c30115a.js.map
