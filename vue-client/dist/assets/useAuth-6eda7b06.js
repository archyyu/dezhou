import{u as p}from"./useApi-0fdb8b38.js";import{z as f,f as o,l as S,A as I}from"./index-e3c589d7.js";const U=f("game",{state:()=>({currentUser:null,currentRoom:null,gameState:"LOBBY",players:[],communityCards:[],playerCards:[],currentTurn:0,pot:0,smallBlind:0,bigBlind:0,minBuyIn:0,maxBuyIn:0}),actions:{setUser(e){this.currentUser=e},clearUser(){this.currentUser=null},setRoom(e){this.currentRoom=e,this.smallBlind=e.sbet||0,this.bigBlind=e.bbet||0,this.minBuyIn=e.minbuy||0,this.maxBuyIn=e.maxbuy||0},clearRoom(){this.currentRoom=null,this.players=[],this.communityCards=[],this.playerCards=[],this.currentTurn=0,this.pot=0},setGameState(e){this.gameState=e},updatePlayer(e){const t=this.players.findIndex(a=>a.uid===e.uid);t>=0?this.players[t]=e:this.players.push(e)},removePlayer(e){this.players=this.players.filter(t=>t.uid!==e)},setCommunityCards(e){this.communityCards=e},addCommunityCard(e){this.communityCards.push(e)},setPlayerCards(e){this.playerCards=e},setTurn(e){this.currentTurn=e},setPot(e){this.pot=e},resetGame(){this.gameState="LOBBY",this.communityCards=[],this.playerCards=[],this.currentTurn=0,this.pot=0}},getters:{isPlayerTurn:e=>{var t;return e.currentTurn===((t=e.currentUser)==null?void 0:t.uid)},currentPlayer:e=>e.players.find(t=>{var a;return t.uid===((a=e.currentUser)==null?void 0:a.uid)}),isInRoom:e=>e.currentRoom!==null,isGameInProgress:e=>e.gameState==="PLAYING"}});function B(){const e=o(null),t=o(!1),a=o(null),{getUserProfile:m}=p(),u=U(),l=()=>{try{const r=localStorage.getItem("user");if(r){const n=JSON.parse(r);return e.value=n,u.setUser(n),!0}return!1}catch(r){return console.error("Failed to parse user from localStorage:",r),!1}},d=async(r=!1)=>{var n,c;if(!r&&l())return e.value;try{t.value=!0,a.value=null;const s=await m();return s.data?(e.value=s.data,u.setUser(s.data),localStorage.setItem("user",JSON.stringify(s.data)),s.data):null}catch(s){return a.value=((c=(n=s.response)==null?void 0:n.data)==null?void 0:c.message)||s.message||"Failed to fetch user",console.error("Failed to get current user:",s),null}finally{t.value=!1}},h=()=>!!localStorage.getItem("token")&&!!localStorage.getItem("user"),y=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),e.value=null,u.clearUser()},g=()=>localStorage.getItem("token"),i=()=>{e.value&&localStorage.setItem("user",JSON.stringify(e.value))};return S(()=>{l()}),I(e,r=>{r&&(u.setUser(r),i())},{deep:!0}),{user:e,loading:t,error:a,getCurrentUser:d,isAuthenticated:h,clearAuth:y,getToken:g,loadUserFromStorage:l,syncUserToStorage:i}}export{U as a,B as u};
//# sourceMappingURL=useAuth-6eda7b06.js.map
