{"version":3,"file":"useAuth-6eda7b06.js","sources":["../../src/stores/gameStore.js","../../src/composables/useAuth.js"],"sourcesContent":["import { defineStore } from 'pinia'\n\n/**\n * Game store for managing game state\n */\nexport const useGameStore = defineStore('game', {\n  state: () => ({\n    // Current user information\n    currentUser: null,\n    \n    // Current room information\n    currentRoom: null,\n    \n    // Game state\n    gameState: 'LOBBY', // LOBBY, PLAYING, FINISHED\n    \n    // Players in the room\n    players: [],\n    \n    // Game data\n    communityCards: [],\n    playerCards: [],\n    currentTurn: 0,\n    pot: 0,\n    \n    // Game settings\n    smallBlind: 0,\n    bigBlind: 0,\n    minBuyIn: 0,\n    maxBuyIn: 0\n  }),\n  \n  actions: {\n    /**\n     * Set current user\n     */\n    setUser(user) {\n      this.currentUser = user\n    },\n    \n    /**\n     * Clear current user\n     */\n    clearUser() {\n      this.currentUser = null\n    },\n    \n    /**\n     * Set current room\n     */\n    setRoom(room) {\n      this.currentRoom = room\n      this.smallBlind = room.sbet || 0\n      this.bigBlind = room.bbet || 0\n      this.minBuyIn = room.minbuy || 0\n      this.maxBuyIn = room.maxbuy || 0\n    },\n    \n    /**\n     * Clear current room\n     */\n    clearRoom() {\n      this.currentRoom = null\n      this.players = []\n      this.communityCards = []\n      this.playerCards = []\n      this.currentTurn = 0\n      this.pot = 0\n    },\n    \n    /**\n     * Update game state\n     */\n    setGameState(state) {\n      this.gameState = state\n    },\n    \n    /**\n     * Add or update player\n     */\n    updatePlayer(player) {\n      const index = this.players.findIndex(p => p.uid === player.uid)\n      if (index >= 0) {\n        this.players[index] = player\n      } else {\n        this.players.push(player)\n      }\n    },\n    \n    /**\n     * Remove player\n     */\n    removePlayer(uid) {\n      this.players = this.players.filter(p => p.uid !== uid)\n    },\n    \n    /**\n     * Set community cards\n     */\n    setCommunityCards(cards) {\n      this.communityCards = cards\n    },\n    \n    /**\n     * Add community card\n     */\n    addCommunityCard(card) {\n      this.communityCards.push(card)\n    },\n    \n    /**\n     * Set player cards\n     */\n    setPlayerCards(cards) {\n      this.playerCards = cards\n    },\n    \n    /**\n     * Update turn\n     */\n    setTurn(turn) {\n      this.currentTurn = turn\n    },\n    \n    /**\n     * Update pot\n     */\n    setPot(amount) {\n      this.pot = amount\n    },\n    \n    /**\n     * Reset game state\n     */\n    resetGame() {\n      this.gameState = 'LOBBY'\n      this.communityCards = []\n      this.playerCards = []\n      this.currentTurn = 0\n      this.pot = 0\n    }\n  },\n  \n  getters: {\n    /**\n     * Check if it's current player's turn\n     */\n    isPlayerTurn: (state) => {\n      return state.currentTurn === state.currentUser?.uid\n    },\n    \n    /**\n     * Get current player\n     */\n    currentPlayer: (state) => {\n      return state.players.find(p => p.uid === state.currentUser?.uid)\n    },\n    \n    /**\n     * Check if user is in a room\n     */\n    isInRoom: (state) => state.currentRoom !== null,\n    \n    /**\n     * Check if game is in progress\n     */\n    isGameInProgress: (state) => state.gameState === 'PLAYING'\n  }\n})","import { ref, onMounted, watch } from 'vue'\nimport { useApi } from './useApi'\nimport { useGameStore } from '@/stores/gameStore'\n\n/**\n * Authentication composable for managing user session and profile\n * Uses a hybrid approach: Pinia for reactive state + localStorage for persistence\n */\nexport function useAuth() {\n  const user = ref(null)\n  const loading = ref(false)\n  const error = ref(null)\n  const { getUserProfile } = useApi()\n  const gameStore = useGameStore()\n\n  /**\n   * Load user from localStorage and sync with Pinia store\n   */\n  const loadUserFromStorage = () => {\n    try {\n      const storedUser = localStorage.getItem('user')\n      if (storedUser) {\n        const parsedUser = JSON.parse(storedUser)\n        user.value = parsedUser\n        gameStore.setUser(parsedUser) // Sync with Pinia store\n        return true\n      }\n      return false\n    } catch (err) {\n      console.error('Failed to parse user from localStorage:', err)\n      return false\n    }\n  }\n\n  /**\n   * Get current user - tries localStorage first, then API\n   * Always syncs with Pinia store for reactivity\n   */\n  const getCurrentUser = async (forceRefresh = false) => {\n    if (!forceRefresh && loadUserFromStorage()) {\n      return user.value\n    }\n\n    try {\n      loading.value = true\n      error.value = null\n      \n      const response = await getUserProfile()\n      if (response.data) {\n        user.value = response.data\n        gameStore.setUser(response.data) // Sync with Pinia store\n        // Update localStorage with fresh data\n        localStorage.setItem('user', JSON.stringify(response.data))\n        return response.data\n      }\n      return null\n    } catch (err) {\n      error.value = err.response?.data?.message || err.message || 'Failed to fetch user'\n      console.error('Failed to get current user:', err)\n      return null\n    } finally {\n      loading.value = false\n    }\n  }\n\n  /**\n   * Check if user is authenticated\n   */\n  const isAuthenticated = () => {\n    return !!localStorage.getItem('token') && !!localStorage.getItem('user')\n  }\n\n  /**\n   * Clear authentication data from both localStorage and Pinia\n   */\n  const clearAuth = () => {\n    localStorage.removeItem('token')\n    localStorage.removeItem('user')\n    user.value = null\n    gameStore.clearUser()\n  }\n\n  /**\n   * Get authentication token\n   */\n  const getToken = () => {\n    return localStorage.getItem('token')\n  }\n\n  /**\n   * Sync user changes to localStorage for persistence\n   */\n  const syncUserToStorage = () => {\n    if (user.value) {\n      localStorage.setItem('user', JSON.stringify(user.value))\n    }\n  }\n\n  // Load user from storage on mount\n  onMounted(() => {\n    loadUserFromStorage()\n  })\n\n  // Watch for user changes and sync to localStorage\n  watch(user, (newUser) => {\n    if (newUser) {\n      gameStore.setUser(newUser)\n      syncUserToStorage()\n    }\n  }, { deep: true })\n\n  return {\n    user,\n    loading,\n    error,\n    getCurrentUser,\n    isAuthenticated,\n    clearAuth,\n    getToken,\n    loadUserFromStorage,\n    syncUserToStorage\n  }\n}"],"names":["useGameStore","defineStore","user","room","state","player","index","p","uid","cards","card","turn","amount","_a","useAuth","ref","loading","error","getUserProfile","useApi","gameStore","loadUserFromStorage","storedUser","parsedUser","err","getCurrentUser","forceRefresh","response","_b","isAuthenticated","clearAuth","getToken","syncUserToStorage","onMounted","watch","newUser"],"mappings":"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"}